# è´¡çŒ®æŒ‡å—

æ„Ÿè°¢æ‚¨å¯¹ AnotherMonkey çš„å…³æ³¨ï¼æˆ‘ä»¬æ¬¢è¿æ‰€æœ‰å½¢å¼çš„è´¡çŒ®ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š

- ğŸ› æŠ¥å‘Š Bug
- ğŸ’¡ æå‡ºæ–°åŠŸèƒ½å»ºè®®
- ğŸ“ æ”¹è¿›æ–‡æ¡£
- ğŸ”§ æäº¤ä»£ç ä¿®å¤
- ğŸ¨ æ”¹è¿› UI/UX
- ğŸŒ æ·»åŠ å›½é™…åŒ–æ”¯æŒ

---

## å¼€å§‹ä¹‹å‰

### ä»£ç è§„èŒƒ

åœ¨æäº¤ä»£ç ä¹‹å‰ï¼Œè¯·ç¡®ä¿ï¼š

1. **ä»£ç é£æ ¼**
   - ä½¿ç”¨ TypeScript ç¼–å†™ä»£ç 
   - éµå¾ªç°æœ‰çš„ä»£ç é£æ ¼
   - ä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡å’Œå‡½æ•°å
   - æ·»åŠ å¿…è¦çš„æ³¨é‡Šï¼ˆä¸­æ–‡ï¼‰

2. **æäº¤ä¿¡æ¯**
   - ä½¿ç”¨æ¸…æ™°çš„æäº¤ä¿¡æ¯
   - å‚è€ƒ [Conventional Commits](https://www.conventionalcommits.org/)
   - ç¤ºä¾‹ï¼š
     ```
     feat: add script export functionality
     fix: resolve metadata parsing issue
     docs: update API documentation
     ```

3. **ç±»å‹å®‰å…¨**
   - æ‰€æœ‰æ–°ä»£ç å¿…é¡»æœ‰ç±»å‹æ³¨è§£
   - é¿å…ä½¿ç”¨ `any` ç±»å‹
   - ä½¿ç”¨æ¥å£å®šä¹‰æ•°æ®ç»“æ„

4. **é”™è¯¯å¤„ç†**
   - å¦¥å–„å¤„ç†æ‰€æœ‰å¯èƒ½çš„é”™è¯¯
   - ä½¿ç”¨ logger è®°å½•é”™è¯¯
   - å‘ç”¨æˆ·æä¾›å‹å¥½çš„é”™è¯¯æ¶ˆæ¯

---

## å¼€å‘ç¯å¢ƒè®¾ç½®

### 1. Fork ä»“åº“

ç‚¹å‡» GitHub é¡µé¢å³ä¸Šè§’çš„ "Fork" æŒ‰é’®ã€‚

### 2. å…‹éš†ä»“åº“

```bash
# å…‹éš†ä½ çš„ Fork
git clone https://github.com/your-username/Anothermonkey.git
cd Anothermonkey

# æ·»åŠ ä¸Šæ¸¸ä»“åº“
git remote add upstream https://github.com/anothermonkey/Anothermonkey.git
```

### 3. å®‰è£…ä¾èµ–

```bash
npm install
```

### 4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

### 5. åŠ è½½æ‰©å±•åˆ°æµè§ˆå™¨

1. æ‰“å¼€ Chrome æµè§ˆå™¨
2. è®¿é—® `chrome://extensions/`
3. å¯ç”¨"å¼€å‘è€…æ¨¡å¼"
4. ç‚¹å‡»"åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº"
5. é€‰æ‹© `build/chrome-mv3-dev` ç›®å½•

### 6. çƒ­é‡è½½

Plasmo æ”¯æŒçƒ­é‡è½½ï¼Œä¿®æ”¹ä»£ç åè‡ªåŠ¨é‡æ–°ç¼–è¯‘ã€‚

---

## é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ background/          # Service Worker åå°æœåŠ¡
â”‚   â”œâ”€â”€ index.ts       # ä¸»å…¥å£ï¼Œç›‘å¬æ¶ˆæ¯å’Œäº‹ä»¶
â”‚   â””â”€â”€ api-handler.ts # GM API ä»£ç†å¤„ç†å™¨
â”œâ”€â”€ contents/          # Content Scripts
â”‚   â””â”€â”€ install.tsx   # æ‹¦æˆª .user.js æ–‡ä»¶
â”œâ”€â”€ tabs/              # æ‰©å±•é¡µé¢
â”‚   â”œâ”€â”€ install.tsx    # è„šæœ¬å®‰è£…é¡µé¢
â”‚   â””â”€â”€ permission.tsx # æƒé™è¯·æ±‚é¡µé¢
â”œâ”€â”€ components/        # React ç»„ä»¶
â”‚   â”œâ”€â”€ ScriptList.tsx # è„šæœ¬åˆ—è¡¨
â”‚   â”œâ”€â”€ ScriptEditor.tsx # è„šæœ¬ç¼–è¾‘å™¨
â”‚   â””â”€â”€ Toast.tsx     # é€šçŸ¥ç»„ä»¶
â”œâ”€â”€ lib/              # æ ¸å¿ƒåº“
â”‚   â”œâ”€â”€ db.ts          # IndexedDB æ•°æ®åº“
â”‚   â”œâ”€â”€ parser.ts      # å…ƒæ•°æ®è§£æå™¨
â”‚   â”œâ”€â”€ script-manager.ts # è„šæœ¬ç®¡ç†å™¨
â”‚   â”œâ”€â”€ gm-api.ts      # GM API å®ç°
â”‚   â”œâ”€â”€ matcher.ts     # URL åŒ¹é…å™¨
â”‚   â”œâ”€â”€ logger.ts      # æ—¥å¿—ç³»ç»Ÿ
â”‚   â”œâ”€â”€ cloud-sync.ts  # äº‘åŒæ­¥
â”‚   â”œâ”€â”€ script-stats.ts # è„šæœ¬ç»Ÿè®¡
â”‚   â””â”€â”€ types.ts      # ç±»å‹å®šä¹‰
â”œâ”€â”€ options.tsx        # é€‰é¡¹é¡µé¢
â””â”€â”€ popup.tsx         # å¼¹å‡ºçª—å£
```

---

## å¼€å‘å·¥ä½œæµ

### 1. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯

```bash
git checkout main
git pull upstream main
git checkout -b feature/your-feature-name
```

### 2. ç¼–å†™ä»£ç 

- åœ¨ç›¸åº”ç›®å½•ä¸‹åˆ›å»ºæˆ–ä¿®æ”¹æ–‡ä»¶
- éµå¾ªç°æœ‰çš„ä»£ç é£æ ¼
- æ·»åŠ å¿…è¦çš„æµ‹è¯•

### 3. æµ‹è¯•

```bash
# è¿è¡Œå¼€å‘æœåŠ¡å™¨
npm run dev

# åŠ è½½æ‰©å±•åˆ°æµè§ˆå™¨
# æµ‹è¯•ä½ çš„æ›´æ”¹
```

### 4. æäº¤æ›´æ”¹

```bash
git add .
git commit -m "feat: add your feature description"
```

### 5. æ¨é€åˆ° Fork

```bash
git push origin feature/your-feature-name
```

### 6. åˆ›å»º Pull Request

1. è®¿é—®ä½ çš„ Fork é¡µé¢
2. ç‚¹å‡» "New Pull Request"
3. å¡«å†™ PR æè¿°ï¼š
   - æè¿°ä½ åšäº†ä»€ä¹ˆ
   - è¯´æ˜ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªæ›´æ”¹
   - æä¾›æµ‹è¯•æ­¥éª¤
   - æ·»åŠ ç›¸å…³ issue é“¾æ¥

---

## æµ‹è¯•æŒ‡å—

### å•å…ƒæµ‹è¯•

é¡¹ç›®ä½¿ç”¨ Jest è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚

```bash
# è¿è¡Œæµ‹è¯•
npm test

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡
npm run test:coverage
```

### ç«¯åˆ°ç«¯æµ‹è¯•

é¡¹ç›®ä½¿ç”¨ Plasmo çš„ E2E æµ‹è¯•æ¡†æ¶ã€‚

```bash
# è¿è¡Œ E2E æµ‹è¯•
npm run test:e2e
```

### æ‰‹åŠ¨æµ‹è¯•æ¸…å•

æäº¤ PR å‰ï¼Œè¯·ç¡®ä¿ï¼š

- [ ] è„šæœ¬å®‰è£…åŠŸèƒ½æ­£å¸¸
- [ ] è„šæœ¬ç¼–è¾‘å’Œä¿å­˜æ­£å¸¸
- [ ] GM APIï¼ˆå­˜å‚¨ã€ç½‘ç»œã€é€šçŸ¥ç­‰ï¼‰æ­£å¸¸
- [ ] è„šæœ¬åœ¨åŒ¹é…é¡µé¢æ­£ç¡®è¿è¡Œ
- [ ] æ·±è‰²æ¨¡å¼åˆ‡æ¢æ­£å¸¸
- [ ] äº‘åŒæ­¥åŠŸèƒ½æ­£å¸¸
- [ ] é”™è¯¯å¤„ç†å‹å¥½
- [ ] UI åœ¨ä¸åŒåˆ†è¾¨ç‡ä¸‹æ­£å¸¸
- [ ] åœ¨ Chrome ä¸­æµ‹è¯•ï¼ˆä¸»ç›®æ ‡æµè§ˆå™¨ï¼‰

---

## æ·»åŠ æ–°åŠŸèƒ½

### æ·»åŠ æ–°çš„ GM API

1. **åœ¨ `lib/gm-types.ts` ä¸­å®šä¹‰ç±»å‹**

```typescript
export const GM_TYPES = `
// æ·»åŠ æ–°çš„ API ç±»å‹å£°æ˜
declare function GM_newAPI(options: NewAPIOptions): ReturnType;
`;
```

2. **åœ¨ `lib/gm-api.ts` ä¸­å®ç° API**

```typescript
window.GM_newAPI = function (options) {
  // å®ç°é€»è¾‘
};
```

3. **åœ¨ `lib/background/api-handler.ts` ä¸­å¤„ç†åå°è¯·æ±‚**

```typescript
case "GM_newAPI": {
  // å¤„ç†åå°è¯·æ±‚
  return { success: true };
}
```

4. **åœ¨ `lib/parser.ts` ä¸­æ·»åŠ  @grant è§£æ**

```typescript
case "grant":
  if (value) metadata.grants.push(value);
  break;
```

### æ·»åŠ æ–°çš„ UI ç»„ä»¶

1. **åœ¨ `src/components/` ä¸­åˆ›å»ºç»„ä»¶**

```typescript
import React from 'react';
import clsx from 'clsx';

export const MyComponent: React.FC<Props> = ({ prop1, prop2 }) => {
  return (
    <div className={clsx('base-class', isActive && 'active-class')}>
      {/* å†…å®¹ */}
    </div>
  );
};
```

2. **åœ¨çˆ¶ç»„ä»¶ä¸­ä½¿ç”¨**

```typescript
import { MyComponent } from '~components/MyComponent';

// åœ¨ JSX ä¸­ä½¿ç”¨
<MyComponent prop1="value" prop2={123} />
```

### æ·»åŠ æ–°çš„æ•°æ®åº“è¡¨

1. **åœ¨ `lib/types.ts` ä¸­å®šä¹‰ç±»å‹**

```typescript
export interface MyNewType {
  id: string;
  field1: string;
  field2: number;
}
```

2. **åœ¨ `lib/db.ts` ä¸­æ·»åŠ è¡¨**

```typescript
export class AnotherMonkeyDB extends Dexie {
  myNewTable!: Table<MyNewType, string>;

  constructor() {
    super("anothermonkey_db");
    this.version(4).stores({
      // ... ç°æœ‰è¡¨
      myNewTable: "id, field1",
    });
  }
}
```

3. **è¿ç§»å¤„ç†**

```typescript
// åœ¨æ„é€ å‡½æ•°ä¸­æ·»åŠ ç‰ˆæœ¬è¿ç§»
this.version(4).upgrade((tx) => {
  // ä»æ—§ç‰ˆæœ¬è¿ç§»æ•°æ®
});
```

---

## æ–‡æ¡£è´¡çŒ®

### æ”¹è¿›ç°æœ‰æ–‡æ¡£

1. ç›´æ¥ç¼–è¾‘ `docs/` ç›®å½•ä¸‹çš„ Markdown æ–‡ä»¶
2. ç¡®ä¿æ ¼å¼æ­£ç¡®ï¼ˆä½¿ç”¨ Markdownï¼‰
3. æ·»åŠ ç¤ºä¾‹å’Œä»£ç ç‰‡æ®µ
4. ä¿æŒä¸ä»£ç åŒæ­¥

### æ·»åŠ æ–°æ–‡æ¡£

å¦‚æœæ·»åŠ æ–°åŠŸèƒ½ï¼Œè¯·åˆ›å»ºç›¸åº”çš„æ–‡æ¡£ï¼š

- åŠŸèƒ½è¯´æ˜
- API å‚è€ƒ
- ä½¿ç”¨ç¤ºä¾‹
- å¸¸è§é—®é¢˜

### æ–‡æ¡£é£æ ¼

- ä½¿ç”¨æ¸…æ™°çš„æ ‡é¢˜å’Œå­æ ‡é¢˜
- æä¾›ä»£ç ç¤ºä¾‹
- ä½¿ç”¨è¡¨æ ¼å±•ç¤ºå‚æ•°å’Œè¿”å›å€¼
- æ·»åŠ é€‚å½“çš„è¡¨æƒ…ç¬¦å·å¢å¼ºå¯è¯»æ€§

---

## æŠ¥å‘Š Bug

### Bug æŠ¥å‘Šæ¨¡æ¿

```markdown
**æè¿°**
ç®€è¦æè¿° Bugã€‚

**å¤ç°æ­¥éª¤**

1. æ‰“å¼€ '...'
2. ç‚¹å‡» '....'
3. æ»šåŠ¨åˆ° '....'
4. çœ‹åˆ°é”™è¯¯

**é¢„æœŸè¡Œä¸º**
åº”è¯¥å‘ç”Ÿä»€ä¹ˆã€‚

**å®é™…è¡Œä¸º**
å®é™…å‘ç”Ÿäº†ä»€ä¹ˆã€‚

**ç¯å¢ƒ**

- æ“ä½œç³»ç»Ÿ: [ä¾‹å¦‚: macOS, Windows, Linux]
- æµè§ˆå™¨: [ä¾‹å¦‚: Chrome 120, Firefox 121]
- æ‰©å±•ç‰ˆæœ¬: [ä¾‹å¦‚: 0.1.0]

**æ—¥å¿—**
[å¦‚æœæœ‰é”™è¯¯æ—¥å¿—ï¼Œè¯·ç²˜è´´åˆ°è¿™é‡Œ]
```

---

## åŠŸèƒ½è¯·æ±‚

### åŠŸèƒ½è¯·æ±‚æ¨¡æ¿

```markdown
**é—®é¢˜æè¿°**
æ¸…æ™°ç®€æ´åœ°æè¿°ä½ æƒ³è¦çš„åŠŸèƒ½ã€‚

**è§£å†³æ–¹æ¡ˆ**
æè¿°ä½ å¸Œæœ›å¦‚ä½•å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚

**æ›¿ä»£æ–¹æ¡ˆ**
æè¿°ä½ è€ƒè™‘è¿‡çš„æ›¿ä»£æ–¹æ¡ˆæˆ–åŠŸèƒ½ã€‚

**é™„åŠ ä¿¡æ¯**
ä»»ä½•å…¶ä»–å…³äºæ­¤åŠŸèƒ½è¯·æ±‚çš„ä¸Šä¸‹æ–‡ä¿¡æ¯æˆ–æˆªå›¾ã€‚
```

---

## ä»£ç å®¡æŸ¥

### æäº¤ PR å‰çš„æ£€æŸ¥

- [ ] ä»£ç éµå¾ªé¡¹ç›®çš„ä»£ç è§„èŒƒ
- [ ] å·²æ·»åŠ å¿…è¦çš„æµ‹è¯•
- [ ] æµ‹è¯•å…¨éƒ¨é€šè¿‡
- [ ] æ–‡æ¡£å·²æ›´æ–°ï¼ˆå¦‚æœéœ€è¦ï¼‰
- [ ] æäº¤ä¿¡æ¯æ¸…æ™°æ˜äº†
- [ ] æ²¡æœ‰ console.log æˆ–è°ƒè¯•ä»£ç 
- [ ] æ²¡æœ‰æ•æ„Ÿä¿¡æ¯ï¼ˆå¯†é’¥ã€ä»¤ç‰Œç­‰ï¼‰

### PR å®¡æŸ¥æµç¨‹

1. **è‡ªåŠ¨åŒ–æ£€æŸ¥**ï¼šCI/CD æµç¨‹è‡ªåŠ¨è¿è¡Œæµ‹è¯•å’Œ lint
2. **ä»£ç å®¡æŸ¥**ï¼šç»´æŠ¤è€…å®¡æŸ¥ä»£ç å¹¶æä¾›åé¦ˆ
3. **ä¿®æ”¹**ï¼šæ ¹æ®åé¦ˆè¿›è¡Œå¿…è¦çš„ä¿®æ”¹
4. **åˆå¹¶**ï¼šé€šè¿‡å®¡æŸ¥ååˆå¹¶åˆ°ä¸»åˆ†æ”¯

---

## å‘å¸ƒæµç¨‹

### ç‰ˆæœ¬å·

éµå¾ª [è¯­ä¹‰åŒ–ç‰ˆæœ¬](https://semver.org/)ï¼š

- **ä¸»ç‰ˆæœ¬å· (MAJOR)**ï¼šä¸å…¼å®¹çš„ API æ›´æ”¹
- **æ¬¡ç‰ˆæœ¬å· (MINOR)**ï¼šå‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ–°å¢
- **ä¿®è®¢å· (PATCH)**ï¼šå‘ä¸‹å…¼å®¹çš„é—®é¢˜ä¿®æ­£

### å‘å¸ƒæ­¥éª¤

1. æ›´æ–° `package.json` ä¸­çš„ç‰ˆæœ¬å·
2. æ›´æ–° `CHANGELOG.md`
3. åˆ›å»º Git æ ‡ç­¾
4. æ„å»ºç”Ÿäº§ç‰ˆæœ¬
5. å‘å¸ƒåˆ° Chrome Web Store

---

## ç¤¾åŒº

- **GitHub**: [https://github.com/anothermonkey/Anothermonkey](https://github.com/anothermonkey/Anothermonkey)
- **Issues**: [https://github.com/anothermonkey/Anothermonkey/issues](https://github.com/anothermonkey/Anothermonkey/issues)
- **Discussions**: [https://github.com/anothermonkey/Anothermonkey/discussions](https://github.com/anothermonkey/Anothermonkey/discussions)

---

## è¡Œä¸ºå‡†åˆ™

### æˆ‘ä»¬æ‰¿è¯º

- å°Šé‡ä¸åŒçš„è§‚ç‚¹å’Œç»éªŒ
- ä¼˜é›…åœ°æ¥å—å»ºè®¾æ€§æ‰¹è¯„
- å…³æ³¨å¯¹ç¤¾åŒºæœ€æœ‰åˆ©çš„äº‹æƒ…
- å¯¹å…¶ä»–ç¤¾åŒºæˆå‘˜è¡¨ç¤ºåŒç†å¿ƒ

### ä¸å¯æ¥å—çš„è¡Œä¸º

- ä½¿ç”¨æ€§åŒ–çš„è¯­è¨€æˆ–å›¾åƒ
- äººèº«æ”»å‡»æˆ–æ”¿æ²»æ”»å‡»
- å…¬å¼€æˆ–ç§ä¸‹éªšæ‰°
- æœªç»æ˜ç¡®è®¸å¯å‘å¸ƒä»–äººçš„ç§äººä¿¡æ¯
- å…¶ä»–ä¸é“å¾·æˆ–ä¸ä¸“ä¸šçš„è¡Œä¸º

---

## è®¸å¯è¯

é€šè¿‡è´¡çŒ®ä»£ç ï¼Œæ‚¨åŒæ„æ‚¨çš„è´¡çŒ®å°†åœ¨ [MIT è®¸å¯è¯](LICENSE) ä¸‹å‘å¸ƒã€‚

---

## è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰ä¸º AnotherMonkey åšå‡ºè´¡çŒ®çš„å¼€å‘è€…ï¼

---

## é—®é¢˜ï¼Ÿ

å¦‚æœä½ åœ¨è´¡çŒ®è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹ [æ–‡æ¡£](docs/)
2. æœç´¢ [Issues](https://github.com/anothermonkey/Anothermonkey/issues)
3. åˆ›å»ºæ–°çš„ Issue æé—®

æˆ‘ä»¬å¾ˆä¹æ„å¸®åŠ©ä½ ï¼
